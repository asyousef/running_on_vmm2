#include "/vmm/bin/common.defs"
#include "/vmm/data/user_disks/vmxc/common.vmx.p3.defs"
#define CENTOSDISK  basedisk "/vmm/data/user_disks/irzan/centos300g.img";
#define VMX_DISK0  basedisk "/vmm/data/user_disks/irzan/vmx-19.4R1.10/junos-vmx-x86-64-19.4R1.10.vmdk";
#define VMX_DISK1  basedisk "/vmm/data/user_disks/irzan/vmx-19.4R1.10/vFPC-20191114.img";
#define VMX_DISK0  basedisk "/vmm/data/user_disks/irzan/vmx-19.4R1.10/junos-vmx-x86-64-19.4R1.10.vmdk";
#define VMX_DISK1  basedisk "/vmm/data/user_disks/irzan/vmx-19.4R1.10/vFPC-20191114.img";
#define VQFX_RE  basedisk "/vmm/data/user_disks/irzan/vqfx/jinstall-vqfx-10-f-19.4R1.10.vmdk";
#define VQFX_COSIM  basedisk "/vmm/data/user_disks/irzan/vqfx/vqfx-19.4R1-2019010209-pfe-qemu.vmdk";
#define UBUNTUDISK basedisk "/vmm/data/user_disks/irzan/ubuntu160406.img";
config "lab1"{
  bridge "vmx1ge0"{};
  bridge "vmx2ge0"{};
  bridge "mgmt"{};
  bridge "vmx1ge1"{};
  bridge "vmx1vmx2"{};
  bridge "vmx1qfx1"{};
  bridge "vmx2ge1"{};
  bridge "vmx2qfx1"{};
  bridge "vqfx1xe2"{};
  bridge "pc1pc2"{};
  bridge "reserved_bridge" {};
  bridge "vqfx1INT"{};
  PRIVATE_BRIDGES
vm "gw" {
   hostname "gw";
   CENTOSDISK
   setvar "+qemu_args" "-cpu qemu64,+vmx";
   ncpus 1;
   memory 2048;
   interface "em0" { bridge "external";};
   interface "em1" { bridge "vmx1ge0";};
   interface "em2" { bridge "vmx2ge0";};
   interface "em3" { bridge "mgmt";};
   install "/vmm/data/user_disks/irzan/lab1/hostname.gw" "/etc/hostname";
   install "/vmm/data/user_disks/irzan/lab1/hosts" "/etc/hosts";
   install "/vmm/data/user_disks/irzan/lab1/ifcfg-eth1.gw" "/etc/sysconfig/network-scripts/ifcfg-eth1";
   install "/vmm/data/user_disks/irzan/lab1/ifcfg-eth2.gw" "/etc/sysconfig/network-scripts/ifcfg-eth2";
   install "/vmm/data/user_disks/irzan/lab1/ifcfg-eth3.gw" "/etc/sysconfig/network-scripts/ifcfg-eth3";
   install "/vmm/data/user_disks/irzan/lab1/01-ip_forward.conf" "/etc/sysctl.d/01-ip_forward.conf";
   install "/vmm/data/user_disks/irzan/lab1/rc.local.gw" "/etc/rc.d/rc.local";
};
   
   #undef EM_IPADDR
   #define EM_IPADDR interface "em0" { bridge "mgmt";};
   #define VMX_CHASSIS_I2CID 21
   #define VMX_CHASSIS_NAME vmx1
   VMX_CHASSIS_START() 
      VMX_RE_START(vmx1_re,0)
         VMX_RE_INSTANCE(vmx1_re0, VMX_DISK0, VMX_RE_I2CID,0)
         install "/vmm/data/user_disks/irzan/lab1/vmx1.conf" "/root/junos.base.conf";
      VMX_RE_END
      VMX_MPC_START(vmx1_MP,0)
        VMX_MPC_INSTANCE(vmx1_MPC, VMX_DISK1, VMX_MPC_I2CID, 0)
            VMX_CONNECT(GE(0,0,0), vmx1ge0)
            VMX_CONNECT(GE(0,0,1), vmx1ge1)
            VMX_CONNECT(GE(0,0,2), vmx1vmx2)
            VMX_CONNECT(GE(0,0,3), vmx1qfx1)
      VMX_MPC_END
   VMX_CHASSIS_END
   #undef VMX_CHASSIS_I2CID
   #undef VMX_CHASSIS_NAME
   
   #undef EM_IPADDR
   #define EM_IPADDR interface "em0" { bridge "mgmt";};
   #define VMX_CHASSIS_I2CID 161
   #define VMX_CHASSIS_NAME vmx2
   VMX_CHASSIS_START() 
      VMX_RE_START(vmx2_re,0)
         VMX_RE_INSTANCE(vmx2_re0, VMX_DISK0, VMX_RE_I2CID,0)
         install "/vmm/data/user_disks/irzan/lab1/vmx2.conf" "/root/junos.base.conf";
      VMX_RE_END
      VMX_MPC_START(vmx2_MP,0)
        VMX_MPC_INSTANCE(vmx2_MPC, VMX_DISK1, VMX_MPC_I2CID, 0)
            VMX_CONNECT(GE(0,0,0), vmx2ge0)
            VMX_CONNECT(GE(0,0,1), vmx2ge1)
            VMX_CONNECT(GE(0,0,2), vmx1vmx2)
            VMX_CONNECT(GE(0,0,3), vmx2qfx1)
      VMX_MPC_END
   VMX_CHASSIS_END
   #undef VMX_CHASSIS_I2CID
   #undef VMX_CHASSIS_NAME

   vm "vqfx1_re" {
      hostname "vqfx1_re";
      VQFX_RE
      setvar "boot_noveriexec" "YES";
      setvar "qemu_args" "-smbios type=1,product=QFX10K-11";
      install "/vmm/data/user_disks/irzan/lab1/vqfx1.conf" "/root/junos.base.conf";
      interface "em0" { bridge "mgmt"; };
      interface "em1" { bridge "vqfx1INT"; ipaddr "169.254.0.2"; };
      interface "em2" { bridge "reserved_bridge"; };
      interface "em3" { bridge "vmx1qfx1";};
      interface "em4" { bridge "vmx2qfx1";};
      interface "em5" { bridge "vqfx1xe2";};
   };
   vm "vqfx1_cosim" {
      hostname "vqfx1_cosim";
      VQFX_COSIM
      memory 4096;
      ncpus 2;
      interface "em0" { bridge "mgmt"; };
      interface "em1" { bridge "vqfx1INT"; ipaddr "169.254.0.1"; };
   };

vm "pc1" {
   hostname "pc1";
   CENTOSDISK
   setvar "+qemu_args" "-cpu qemu64,+vmx";
   ncpus 1;
   memory 4096;
   interface "em0" { bridge "mgmt";};
   interface "em1" { bridge "vmx1ge1";};
   interface "em2" { bridge "pc1pc2";};
   install "/vmm/data/user_disks/irzan/lab1/hostname.pc1" "/etc/hostname";
   install "/vmm/data/user_disks/irzan/lab1/hosts" "/etc/hosts";
   install "/vmm/data/user_disks/irzan/lab1/ifcfg-eth0.pc1" "/etc/sysconfig/network-scripts/ifcfg-eth0";
   install "/vmm/data/user_disks/irzan/lab1/ifcfg-eth1.pc1" "/etc/sysconfig/network-scripts/ifcfg-eth1";
};
vm "pc2" {
   hostname "pc2";
   UBUNTUDISK
   setvar "+qemu_args" "-cpu qemu64,+vmx";
   ncpus 1;
   memory 4096;
   interface "em0" { bridge "mgmt";};
   interface "em1" { bridge "vmx2ge1";};
   interface "em2" { bridge "pc1pc2";};
   install "/vmm/data/user_disks/irzan/lab1/hostname.pc2" "/etc/hostname";
   install "/vmm/data/user_disks/irzan/lab1/hosts" "/etc/hosts";
   install "/vmm/data/user_disks/irzan/lab1/interfaces.pc2" "/etc/network/interfaces";
};
vm "pc3" {
   hostname "pc3";
   CENTOSDISK
   setvar "+qemu_args" "-cpu qemu64,+vmx";
   ncpus 1;
   memory 4096;
   interface "em0" { bridge "mgmt";};
   interface "em1" { bridge "vqfx1xe2";};
   install "/vmm/data/user_disks/irzan/lab1/hostname.pc3" "/etc/hostname";
   install "/vmm/data/user_disks/irzan/lab1/hosts" "/etc/hosts";
   install "/vmm/data/user_disks/irzan/lab1/ifcfg-eth0.pc3" "/etc/sysconfig/network-scripts/ifcfg-eth0";
   install "/vmm/data/user_disks/irzan/lab1/ifcfg-eth1.pc3" "/etc/sysconfig/network-scripts/ifcfg-eth1";
};
};
